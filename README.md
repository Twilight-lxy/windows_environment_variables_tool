# Windows 环境变量管理器

一个功能强大的 Windows 环境变量管理工具，提供图形化界面来管理系统和用户环境变量，支持备份、恢复、批量编辑等功能。

> **注意**：
> - 本工具直接操作系统环境变量，使用前请确保理解相关风险并做好备份。
> - 部分代码由Github Copilot生成

## 🚀 主要功能

### 📋 环境变量管理

- **查看所有环境变量**：显示系统和用户级别的所有环境变量
- **实时编辑**：在表格中直接编辑环境变量的名称和值
- **搜索过滤**：快速搜索和定位特定的环境变量
- **差异显示**：直观显示当前编辑状态与系统实际状态的差异
- **批量操作**：支持批量添加、删除和修改环境变量

### 💾 备份与恢复

- **YAML 格式**：使用 YAML 格式保存和加载环境变量配置
- **自动备份**：操作前自动创建备份文件
- **版本管理**：保留多个历史备份版本
- **一键恢复**：快速恢复到之前的配置状态

### 🔐 权限管理

- **权限检测**：自动检测当前运行权限（管理员/普通用户）
- **权限提升**：一键切换到管理员权限模式
- **安全提示**：清晰显示当前权限状态和功能限制

### 🎨 用户界面

- **现代化界面**：基于 tkinter 的直观图形界面
- **颜色编码**：不同颜色标识变量状态（新增/修改/删除/相同）
- **状态栏**：实时显示操作状态和统计信息
- **响应式布局**：自适应窗口大小调整

## 📦 安装与运行

### 环境要求

- Python 3.7 或更高版本
- Windows 操作系统
- 管理员权限（修改系统环境变量时需要）

### 快速开始

1. **克隆项目**

   ```bash
   git clone https://github.com/Twilight-lxy/windows_environment_variables_tool.git
   cd windows_environment_variables_tool
   ```
2. **安装依赖**

   ```bash
   pip install -r requirements.txt
   ```

   或手动安装：

   ```bash
   pip install PyYAML>=6.0 tqdm>=4.64.0
   ```
3. **运行程序**

   方式一：使用批处理文件

   ```bash
   start_gui.bat
   ```

   方式二：直接运行Python脚本

   ```bash
   python src/main.py
   ```

## 📖 使用说明

### 基本操作

1. **启动程序**

   - 双击 `start_gui.bat` 或运行 `python src/main.py`
   - 程序会显示当前权限状态（管理员/普通用户）
2. **查看环境变量**

   - 程序启动后会自动加载所有环境变量
   - 使用搜索框快速定位特定变量
   - 不同颜色表示不同状态：
     - 🟢 绿色：新增的变量
     - 🟠 橙色：修改的变量
     - 🔴 红色：待删除的变量
     - ⚪ 白色：未改变的变量
3. **编辑环境变量**

   - 双击表格中的单元格进行编辑
   - 修改完成后按回车键确认
   - 使用右键菜单添加或删除变量
4. **保存更改**

   - 点击"应用更改"按钮将修改写入系统
   - 系统会自动创建备份文件
   - 确认对话框会显示将要进行的操作

### 高级功能

#### 备份与恢复

- **导出配置**：点击"导出到 YAML"保存当前配置
- **导入配置**：点击"从 YAML 导入"加载配置文件
- **自动备份**：每次应用更改前自动创建备份

#### 权限管理

- **查看权限状态**：标题栏显示当前权限级别
- **提升权限**：点击"权限状态"按钮以管理员身份重启
- **功能限制**：普通用户权限下无法修改系统环境变量

## 📁 项目结构

```
envtools/
├── src/                    # 源代码目录
│   ├── main.py            # 主启动文件
│   ├── env_gui.py         # GUI界面模块
│   ├── env_utils.py       # 环境变量操作工具
│   ├── yaml_utils.py      # YAML文件处理工具
│   └── admin_utils.py     # 权限管理工具
├── requirements.txt       # Python依赖包列表
├── start_gui.bat         # Windows批处理启动文件
├── env.yaml              # 当前环境变量配置
└── env_backup_*.yaml     # 自动备份文件
```

## 🔧 配置说明

### YAML 配置格式

环境变量配置文件使用以下格式：

```yaml
machine:  # 系统级环境变量
  - name: PATH
    value: C:\Windows\System32;C:\Windows
    kind: ExpandString
  - name: TEMP
    value: C:\Windows\Temp
    kind: String

user:     # 用户级环境变量
  - name: USERPROFILE
    value: C:\Users\Username
    kind: ExpandString
```

### 环境变量类型

- `String`：普通字符串
- `ExpandString`：可展开的字符串（包含其他环境变量引用）

## ⚠️ 注意事项

1. **权限要求**

   - 修改系统环境变量需要管理员权限
   - 建议以管理员身份运行程序以获得完整功能
2. **备份重要**

   - 修改环境变量前请确保已创建备份
   - 建议手动导出重要配置
3. **系统影响**

   - 环境变量更改可能影响系统行为
   - 建议在了解变量用途的情况下进行修改
4. **重启生效**

   - 某些环境变量更改可能需要重启应用程序或系统才能生效

## 🐛 问题排查

### 常见问题

1. **ImportError: No module named 'xxx'**

   ```bash
   pip install -r requirements.txt
   ```
2. **权限不足错误**

   - 右键点击程序，选择"以管理员身份运行"
   - 或在程序中点击"权限状态"按钮提升权限
3. **环境变量不生效**

   - 重启相关应用程序
   - 必要时重启系统
4. **备份文件损坏**

   - 检查 YAML 文件语法
   - 使用文本编辑器手动修复格式错误

## 🤝 贡献

欢迎提交问题报告、功能请求或代码贡献！

## 📞 支持

如果您在使用过程中遇到问题，可以：

- 在 GitHub 上提交 Issue
- 查看项目 Wiki 获取详细文档
- 联系项目维护者
